{
    "openapi": "3.0.0",
    "info": {
        "title": "uniquery",
        "version": "1.0"
    },
    "servers": [
        {
            "url": "http://localhost:13011"
        }
    ],
    "paths": {
        "/api/uniquery/v1/dsl/_search/scroll": {
            "post": {
                "requestBody": {
                    "description": "Post the necessary fields for the API to get next scroll result.",
                    "content": {
                        "application/json": {
                            "schema": {
                                "description": "",
                                "required": [
                                    "scroll_id"
                                ],
                                "type": "object",
                                "properties": {
                                    "scroll": {
                                        "description": "为本次请求保留分页搜索上下文的有效时间（支持数字+时间单位s,m,h），最长不超过24h",
                                        "minLength": 1,
                                        "type": "string"
                                    },
                                    "scroll_id": {
                                        "description": "分页查询id",
                                        "minLength": 1,
                                        "type": "string"
                                    }
                                },
                                "x-examples": {
                                    "example-1": {
                                        "scroll_retention_time": "1m",
                                        "scroll_id": "FGluY2x1ZGVfY29udGV4dF91dWlkDnF1ZXJ5VGhlbkZldGNoBhQ2WkZjUW5vQlRsOTFDMVZfTWtmTwAAAAAAAB0uFlNoWHlMdDJJUXFHcmZjQ19hNnFEbkEUNnBGY1Fub0JUbDkxQzFWX01rZlQAAAAAAAAdLxZTaFh5THQySVFxR3JmY0NfYTZxRG5BFDdaRmNRbm9CVGw5MUMxVl9Na2ZVAAAAAAAAHTIWU2hYeUx0MklRcUdyZmNDX2E2cURuQRQ3SkZjUW5vQlRsOTFDMVZfTWtmVQAAAAAAAB0xFlNoWHlMdDJJUXFHcmZjQ19hNnFEbkEUNjVGY1Fub0JUbDkxQzFWX01rZlUAAAAAAAAdMBZTaFh5THQySVFxR3JmY0NfYTZxRG5BFDdwRmNRbm9CVGw5MUMxVl9Na2ZoAAAAAAAAHTMWU2hYeUx0MklRcUdyZmNDX2E2cURuQQ=="
                                    }
                                }
                            },
                            "examples": {
                                "scroll": {
                                    "value": {
                                        "scroll": "1m",
                                        "scroll_id": "FGluY2x1ZGVfY29udGV4dF91dWlkDnF1ZXJ5VGhlbkZldGNoBhQ2WkZjUW5vQlRsOTFDMVZfTWtmTwAAAAAAAB0uFlNoWHlMdDJJUXFHcmZjQ19hNnFEbkEUNnBGY1Fub0JUbDkxQzFWX01rZlQAAAAAAAAdLxZTaFh5THQySVFxR3JmY0NfYTZxRG5BFDdaRmNRbm9CVGw5MUMxVl9Na2ZVAAAAAAAAHTIWU2hYeUx0MklRcUdyZmNDX2E2cURuQRQ3SkZjUW5vQlRsOTFDMVZfTWtmVQAAAAAAAB0xFlNoWHlMdDJJUXFHcmZjQ19hNnFEbkEUNjVGY1Fub0JUbDkxQzFWX01rZlUAAAAAAAAdMBZTaFh5THQySVFxR3JmY0NfYTZxRG5BFDdwRmNRbm9CVGw5MUMxVl9Na2ZoAAAAAAAAHTMWU2hYeUx0MklRcUdyZmNDX2E2cURuQQ=="
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object"
                                },
                                "examples": {
                                    "scroll返回": {
                                        "value": {
                                            "_scroll_id": "FGluY2x1ZGVfY29udGV4dF91dWlkDnF1ZXJ5VGhlbkZldGNoBhRfWkZmUW5vQlRsOTFDMVZfa1VlUQAAAAAAAB08FlNoWHlMdDJJUXFHcmZjQ19hNnFEbkEUXzVGZlFub0JUbDkxQzFWX2tVZVEAAAAAAAAdPhZTaFh5THQySVFxR3JmY0NfYTZxRG5BFC01RmZRbm9CVGw5MUMxVl9rVWVRAAAAAAAAHToWU2hYeUx0MklRcUdyZmNDX2E2cURuQRRfSkZmUW5vQlRsOTFDMVZfa1VlUQAAAAAAAB07FlNoWHlMdDJJUXFHcmZjQ19hNnFEbkEUX3BGZlFub0JUbDkxQzFWX2tVZVEAAAAAAAAdPRZTaFh5THQySVFxR3JmY0NfYTZxRG5BFEFKRmZRbm9CVGw5MUMxVl9rVWlSAAAAAAAAHT8WU2hYeUx0MklRcUdyZmNDX2E2cURuQQ==",
                                            "took": 10,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 6,
                                                "successful": 6,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 2052,
                                                    "relation": "eq"
                                                },
                                                "max_score": 0,
                                                "hits": [
                                                    {
                                                        "_index": "kc-2021.05-0",
                                                        "_type": "_doc",
                                                        "_id": "Da4TonkBxG21l8yYptnO",
                                                        "_score": 0,
                                                        "_source": {
                                                            "host": "node214",
                                                            "arPort": 20015,
                                                            "@version": "1",
                                                            "Body": {
                                                                "ExternalSpan": {

                                                                },
                                                                "Events": {

                                                                },
                                                                "Metrics": {

                                                                }
                                                            },
                                                            "ParentId": "",
                                                            "message": "{\"Version\": \"AISHUV0\", \"TraceId\": \"\", \"SpanId\": \"\", \"ParentId\": \"\", \"StartTime\": \"1621408856003\", \"Attributes\": {\"type\": \"sample logger test\", \"Attribute\": {\"user.id\": \"ABC001\", \"user.dep\": \"\", \"act.type\": \"view doc\", \"topic.id\": \"1000000993\", \"doc.id\": \"300004415\", \"act.label\": \"200000250,200000341,200000455\"}}, \"Resource\": {\"service.name\": \"KC\", \"service.version\": \"1.0.0\", \"k8s.pod.uid\": \"1138528c-c36e-11e9-t235-42010a800198\"}, \"Body\": {\"Events\": {}, \"Metrics\": {}, \"ExternalSpan\": {}}, \"EndTime\": \"\"}\r",
                                                            "Attributes": {
                                                                "Attribute": {
                                                                    "act.type": "view doc",
                                                                    "user.id": "ABC001",
                                                                    "act.label": "200000250,200000341,200000455",
                                                                    "user.dep": "",
                                                                    "doc.id": "300004415",
                                                                    "topic.id": "1000000993"
                                                                },
                                                                "type": "sample logger test"
                                                            },
                                                            "@timestamp": "2021-05-25T05:51:06.730Z",
                                                            "Resource": {
                                                                "service.name": "KC",
                                                                "service.version": "1.0.0",
                                                                "k8s.pod.uid": "1138528c-c36e-11e9-t235-42010a800198"
                                                            },
                                                            "Version": "AISHUV0",
                                                            "TraceId": "",
                                                            "StartTime": "1621408856003",
                                                            "EndTime": "",
                                                            "ruleName": "KC推荐日志",
                                                            "SpanId": "",
                                                            "type": "kc",
                                                            "port": 52568
                                                        }
                                                    }
                                                ]
                                            },
                                            "aggregations": {
                                                "doc_id": {
                                                    "doc_count_error_upper_bound": 17,
                                                    "sum_other_doc_count": 1749,
                                                    "buckets": [
                                                        {
                                                            "key": "1000000645",
                                                            "doc_count": 45
                                                        },
                                                        {
                                                            "key": "1000000073",
                                                            "doc_count": 36
                                                        },
                                                        {
                                                            "key": "1000000220",
                                                            "doc_count": 35
                                                        },
                                                        {
                                                            "key": "1000000074",
                                                            "doc_count": 31
                                                        },
                                                        {
                                                            "key": "1000000195",
                                                            "doc_count": 31
                                                        },
                                                        {
                                                            "key": "1000000697",
                                                            "doc_count": 28
                                                        },
                                                        {
                                                            "key": "1000000503",
                                                            "doc_count": 26
                                                        },
                                                        {
                                                            "key": "1000000394",
                                                            "doc_count": 25
                                                        },
                                                        {
                                                            "key": "1000000141",
                                                            "doc_count": 23
                                                        },
                                                        {
                                                            "key": "1000000466",
                                                            "doc_count": 23
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "scroll结束": {
                                        "value": {
                                            "_scroll_id": "FGluY2x1ZGVfY29udGV4dF91dWlkDnF1ZXJ5VGhlbkZldGNoBhRHWkZ1UW5vQlRsOTFDMVZfMVVoZQAAAAAAAB1BFlNoWHlMdDJJUXFHcmZjQ19hNnFEbkEUR0pGdVFub0JUbDkxQzFWXzFVaGUAAAAAAAAdQBZTaFh5THQySVFxR3JmY0NfYTZxRG5BFEc1RnVRbm9CVGw5MUMxVl8xVWhmAAAAAAAAHUMWU2hYeUx0MklRcUdyZmNDX2E2cURuQRRISkZ1UW5vQlRsOTFDMVZfMVVoZwAAAAAAAB1EFlNoWHlMdDJJUXFHcmZjQ19hNnFEbkEUSFpGdVFub0JUbDkxQzFWXzFVaGcAAAAAAAAdRRZTaFh5THQySVFxR3JmY0NfYTZxRG5BFEdwRnVRbm9CVGw5MUMxVl8xVWhmAAAAAAAAHUIWU2hYeUx0MklRcUdyZmNDX2E2cURuQQ==",
                                            "took": 1,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 6,
                                                "successful": 6,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 2,
                                                    "relation": "eq"
                                                },
                                                "max_score": 0,
                                                "hits": [
                                                ]
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "description": "ok"
                    },
                    "400": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/errorCode"
                                },
                                "examples": {
                                    "illegal_argument_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "illegal_argument_exception",
                                                        "reason": "Cannot parse scroll id"
                                                    }
                                                ],
                                                "type": "illegal_argument_exception",
                                                "reason": "Cannot parse scroll id",
                                                "caused_by": {
                                                    "type": "illegal_argument_exception",
                                                    "reason": "Input byte array has incorrect ending byte at 388"
                                                }
                                            },
                                            "status": 400
                                        }
                                    }
                                }
                            }
                        },
                        "description": "bad request"
                    },
                    "404": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/errorCode"
                                },
                                "examples": {
                                    "search_phase_execution_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "search_context_missing_exception",
                                                        "reason": "No search context found for id [7489]"
                                                    },
                                                    {
                                                        "type": "search_context_missing_exception",
                                                        "reason": "No search context found for id [7488]"
                                                    },
                                                    {
                                                        "type": "search_context_missing_exception",
                                                        "reason": "No search context found for id [7491]"
                                                    },
                                                    {
                                                        "type": "search_context_missing_exception",
                                                        "reason": "No search context found for id [7492]"
                                                    },
                                                    {
                                                        "type": "search_context_missing_exception",
                                                        "reason": "No search context found for id [7493]"
                                                    },
                                                    {
                                                        "type": "search_context_missing_exception",
                                                        "reason": "No search context found for id [7490]"
                                                    }
                                                ],
                                                "type": "search_phase_execution_exception",
                                                "reason": "all shards failed",
                                                "phase": "query",
                                                "grouped": true,
                                                "failed_shards": [
                                                    {
                                                        "shard": -1,
                                                        "reason": {
                                                            "type": "search_context_missing_exception",
                                                            "reason": "No search context found for id [7489]"
                                                        }
                                                    },
                                                    {
                                                        "shard": -1,
                                                        "reason": {
                                                            "type": "search_context_missing_exception",
                                                            "reason": "No search context found for id [7488]"
                                                        }
                                                    },
                                                    {
                                                        "shard": -1,
                                                        "reason": {
                                                            "type": "search_context_missing_exception",
                                                            "reason": "No search context found for id [7491]"
                                                        }
                                                    },
                                                    {
                                                        "shard": -1,
                                                        "reason": {
                                                            "type": "search_context_missing_exception",
                                                            "reason": "No search context found for id [7492]"
                                                        }
                                                    },
                                                    {
                                                        "shard": -1,
                                                        "reason": {
                                                            "type": "search_context_missing_exception",
                                                            "reason": "No search context found for id [7493]"
                                                        }
                                                    },
                                                    {
                                                        "shard": -1,
                                                        "reason": {
                                                            "type": "search_context_missing_exception",
                                                            "reason": "No search context found for id [7490]"
                                                        }
                                                    }
                                                ],
                                                "caused_by": {
                                                    "type": "search_context_missing_exception",
                                                    "reason": "No search context found for id [7490]"
                                                }
                                            },
                                            "status": 404
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Not Found"
                    },
                    "500": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/errorCode"
                                },
                                "examples": {
                                    "example-1": {
                                        "value": {
                                            "error": {
                                                "type": "internal_server_error_exception",
                                                "reason": "internal server error",
                                                "caused_by": {
                                                    "type": "internal_server_error_exception",
                                                    "reason": "error connection"
                                                }
                                            },
                                            "status": 500
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Internal Server Error"
                    }
                },
                "summary": "dsl 翻页搜索",
                "description": ""
            }
        },
        "/api/uniquery/v1/health": {
            "get": {
                "responses": {
                    "200": {
                        "description": "ok"
                    }
                },
                "summary": "健康检查"
            }
        },
        "/api/uniquery/v1/dsl/{x_library}/_search": {
            "description": "",
            "post": {
                "requestBody": {
                    "description": "兼容elasticsearch 7.10.2 和opensearch 1.x的dsl查询语法",
                    "content": {
                        "application/json": {
                            "schema": {
                                "description": "dsl查询语句",
                                "type": "object",
                                "properties": {
                                    "x_library": {
                                        "description": "该参数为dsl之外的扩展参数，指定查询的索引库名称，和路径中一致，非必须参数，若路径和body中均无此参数，则默认空数据集返回，若两个都有，则取交集查询",
                                        "type": "array",
                                        "items": {

                                        }
                                    }
                                }
                            },
                            "examples": {
                                "示例dsl结构": {
                                    "value": {
                                        "aggs": {
                                            "2": {
                                                "date_histogram": {
                                                    "extended_bounds": {
                                                        "min": 0
                                                    },
                                                    "field": "@timestamp",
                                                    "interval": "1M",
                                                    "min_doc_count": 1,
                                                    "time_zone": "Asia/Shanghai"
                                                }
                                            }
                                        },
                                        "query": {
                                            "bool": {
                                                "must": {
                                                    "term": {
                                                        "Attributes.type.keyword": "sample logger test"
                                                    }
                                                },
                                                "filter": [
                                                    {
                                                        "term": {
                                                            "tags": "production"
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "type.keyword": "kclogs"
                                                        }
                                                    },
                                                    {
                                                        "range": {
                                                            "@timestamp": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss||strict_date_optional_time",
                                                                "gte": "2021-07-01T01:49:10.893Z",
                                                                "lt": "2021-07-08T01:49:10.893Z"
                                                            }
                                                        }
                                                    }
                                                ],
                                                "must_not": {
                                                    "range": {
                                                        "age": {
                                                            "gte": 10,
                                                            "lte": 20
                                                        }
                                                    }
                                                },
                                                "should": [
                                                    {
                                                        "term": {
                                                            "tags": "env1"
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "tags": "deployed"
                                                        }
                                                    }
                                                ],
                                                "minimum_should_match": 1
                                            }
                                        }
                                    }
                                },
                                "字段过滤+聚合": {
                                    "value": {
                                        "aggs": {
                                            "doc_id": {
                                                "terms": {
                                                    "field": "Attributes.Attribute.topic.id.keyword"
                                                }
                                            }
                                        },
                                        "query": {
                                            "bool": {
                                                "filter": [
                                                    {
                                                        "range": {
                                                            "StartTime": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss",
                                                                "gte": "2021-07-01 08:49:10",
                                                                "lt": "2021-07-08 08:49:10"
                                                            }
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "Attributes.Attribute.user.id.keyword": "ABC001"
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "Attributes.Attribute.act.type.keyword": "add topic"
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                },
                                "字段过滤+聚合(指定top)": {
                                    "value": {
                                        "aggs": {
                                            "count(sharedLink)": {
                                                "terms": {
                                                    "field": "sharedLink.keyword",
                                                    "order": {
                                                        "_count": "desc"
                                                    },
                                                    "shard_size": 200,
                                                    "size": 100
                                                }
                                            }
                                        },
                                        "query": {
                                            "bool": {
                                                "filter": [
                                                    {
                                                        "range": {
                                                            "StartTime": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss",
                                                                "gte": "1625100550000",
                                                                "lt": "1625705350000"
                                                            }
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "文档库type.keyword": "ABC001"
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "文档库id.keyword": "ABC001"
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                },
                                "top_hits": {
                                    "value": {
                                        "size": 0,
                                        "aggs": {
                                            "count(sharedLink)": {
                                                "terms": {
                                                    "field": "sharedLink.keyword",
                                                    "order": {
                                                        "_count": "desc"
                                                    },
                                                    "shard_size": "200",
                                                    "size": 100
                                                },
                                                "aggs": {
                                                    "top": {
                                                        "top_hits": {
                                                            "size": 1,
                                                            "sort": [
                                                                {
                                                                    "@timestamp": "desc"
                                                                }
                                                            ],
                                                            "_source": {
                                                                "include": [
                                                                    "共享地址url",
                                                                    "共享地址类型",
                                                                    "名称"
                                                                ]
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "query": {
                                            "bool": {
                                                "filter": [
                                                    {
                                                        "range": {
                                                            "StartTime": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss",
                                                                "gte": "2021-07-01T01:49:10.893Z",
                                                                "lt": "2021-07-08T01:49:10.893Z"
                                                            }
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "文档库id.keyword": "ABC001"
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                },
                                "索引库支持放于body中": {
                                    "value": {
                                        "x_library": [
                                            "kclogs",
                                            "shardlink"
                                        ],
                                        "size": 0,
                                        "aggs": {
                                            "count(sharedLink)": {
                                                "terms": {
                                                    "field": "sharedLink.keyword",
                                                    "order": {
                                                        "_count": "desc"
                                                    },
                                                    "shard_size": "200",
                                                    "size": 100
                                                },
                                                "aggs": {
                                                    "top": {
                                                        "top_hits": {
                                                            "size": 1,
                                                            "sort": [
                                                                {
                                                                    "@timestamp": "desc"
                                                                }
                                                            ],
                                                            "_source": {
                                                                "include": [
                                                                    "共享地址url",
                                                                    "共享地址类型",
                                                                    "名称"
                                                                ]
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "query": {
                                            "bool": {
                                                "filter": [
                                                    {
                                                        "range": {
                                                            "StartTime": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss",
                                                                "gte": "2021-07-01T01:49:10.893Z",
                                                                "lt": "2021-07-08T01:49:10.893Z"
                                                            }
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "文档库id.keyword": "ABC001"
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "parameters": [
                    {
                        "name": "scroll",
                        "description": "指定搜索为滚动分页查询，保留分页搜索上下文的有效时间（支持数字+时间单位s,m,h）最长不超过24h",
                        "schema": {
                            "type": "string"
                        },
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object"
                                },
                                "examples": {
                                    "去重统计指定topsize返回": {
                                        "value": {
                                            "took": 2,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 1,
                                                "successful": 1,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 2104,
                                                    "relation": "eq"
                                                },
                                                "hits": [
                                                ]
                                            },
                                            "aggregations": {
                                                "count(sharedLink)": {
                                                    "doc_count_error_upper_bound": 0,
                                                    "sum_other_doc_count": 744,
                                                    "buckets": [
                                                        {
                                                            "key": "1000000838",
                                                            "doc_count": 67
                                                        },
                                                        {
                                                            "key": "1000000196",
                                                            "doc_count": 64
                                                        },
                                                        {
                                                            "key": "1000000517",
                                                            "doc_count": 40
                                                        },
                                                        {
                                                            "key": "1000000119",
                                                            "doc_count": 30
                                                        },
                                                        {
                                                            "key": "1000000393",
                                                            "doc_count": 30
                                                        },
                                                        {
                                                            "key": "1000000502",
                                                            "doc_count": 29
                                                        },
                                                        {
                                                            "key": "1000000601",
                                                            "doc_count": 27
                                                        },
                                                        {
                                                            "key": "1000000639",
                                                            "doc_count": 27
                                                        },
                                                        {
                                                            "key": "1000000991",
                                                            "doc_count": 27
                                                        },
                                                        {
                                                            "key": "1000000544",
                                                            "doc_count": 26
                                                        },
                                                        {
                                                            "key": "1000000229",
                                                            "doc_count": 25
                                                        },
                                                        {
                                                            "key": "1000000021",
                                                            "doc_count": 24
                                                        },
                                                        {
                                                            "key": "1000000970",
                                                            "doc_count": 24
                                                        },
                                                        {
                                                            "key": "1000000596",
                                                            "doc_count": 23
                                                        },
                                                        {
                                                            "key": "1000000977",
                                                            "doc_count": 23
                                                        },
                                                        {
                                                            "key": "1000000200",
                                                            "doc_count": 22
                                                        },
                                                        {
                                                            "key": "1000000925",
                                                            "doc_count": 21
                                                        },
                                                        {
                                                            "key": "1000000358",
                                                            "doc_count": 20
                                                        },
                                                        {
                                                            "key": "1000000361",
                                                            "doc_count": 20
                                                        },
                                                        {
                                                            "key": "1000000468",
                                                            "doc_count": 20
                                                        },
                                                        {
                                                            "key": "1000000519",
                                                            "doc_count": 20
                                                        },
                                                        {
                                                            "key": "1000000613",
                                                            "doc_count": 20
                                                        },
                                                        {
                                                            "key": "1000000636",
                                                            "doc_count": 20
                                                        },
                                                        {
                                                            "key": "1000000419",
                                                            "doc_count": 19
                                                        },
                                                        {
                                                            "key": "1000000805",
                                                            "doc_count": 19
                                                        },
                                                        {
                                                            "key": "1000000820",
                                                            "doc_count": 19
                                                        },
                                                        {
                                                            "key": "1000000109",
                                                            "doc_count": 18
                                                        },
                                                        {
                                                            "key": "1000000009",
                                                            "doc_count": 17
                                                        },
                                                        {
                                                            "key": "1000000118",
                                                            "doc_count": 17
                                                        },
                                                        {
                                                            "key": "1000000132",
                                                            "doc_count": 17
                                                        },
                                                        {
                                                            "key": "1000000143",
                                                            "doc_count": 17
                                                        },
                                                        {
                                                            "key": "1000000342",
                                                            "doc_count": 17
                                                        },
                                                        {
                                                            "key": "1000000437",
                                                            "doc_count": 17
                                                        },
                                                        {
                                                            "key": "1000000146",
                                                            "doc_count": 16
                                                        },
                                                        {
                                                            "key": "1000000181",
                                                            "doc_count": 16
                                                        },
                                                        {
                                                            "key": "1000000202",
                                                            "doc_count": 16
                                                        },
                                                        {
                                                            "key": "1000000340",
                                                            "doc_count": 16
                                                        },
                                                        {
                                                            "key": "1000000370",
                                                            "doc_count": 16
                                                        },
                                                        {
                                                            "key": "1000000703",
                                                            "doc_count": 16
                                                        },
                                                        {
                                                            "key": "1000000407",
                                                            "doc_count": 15
                                                        },
                                                        {
                                                            "key": "1000000662",
                                                            "doc_count": 15
                                                        },
                                                        {
                                                            "key": "1000000673",
                                                            "doc_count": 15
                                                        },
                                                        {
                                                            "key": "1000000866",
                                                            "doc_count": 15
                                                        },
                                                        {
                                                            "key": "1000000557",
                                                            "doc_count": 14
                                                        },
                                                        {
                                                            "key": "1000000808",
                                                            "doc_count": 14
                                                        },
                                                        {
                                                            "key": "1000000821",
                                                            "doc_count": 14
                                                        },
                                                        {
                                                            "key": "1000000835",
                                                            "doc_count": 14
                                                        },
                                                        {
                                                            "key": "1000000576",
                                                            "doc_count": 13
                                                        },
                                                        {
                                                            "key": "1000000686",
                                                            "doc_count": 13
                                                        },
                                                        {
                                                            "key": "1000000815",
                                                            "doc_count": 13
                                                        },
                                                        {
                                                            "key": "1000000141",
                                                            "doc_count": 12
                                                        },
                                                        {
                                                            "key": "1000000485",
                                                            "doc_count": 12
                                                        },
                                                        {
                                                            "key": "1000000714",
                                                            "doc_count": 12
                                                        },
                                                        {
                                                            "key": "1000000742",
                                                            "doc_count": 12
                                                        },
                                                        {
                                                            "key": "1000000895",
                                                            "doc_count": 12
                                                        },
                                                        {
                                                            "key": "1000000087",
                                                            "doc_count": 10
                                                        },
                                                        {
                                                            "key": "1000000263",
                                                            "doc_count": 10
                                                        },
                                                        {
                                                            "key": "1000000496",
                                                            "doc_count": 10
                                                        },
                                                        {
                                                            "key": "1000000741",
                                                            "doc_count": 10
                                                        },
                                                        {
                                                            "key": "1000000881",
                                                            "doc_count": 10
                                                        },
                                                        {
                                                            "key": "1000000516",
                                                            "doc_count": 9
                                                        },
                                                        {
                                                            "key": "1000000732",
                                                            "doc_count": 9
                                                        },
                                                        {
                                                            "key": "1000000398",
                                                            "doc_count": 8
                                                        },
                                                        {
                                                            "key": "1000000503",
                                                            "doc_count": 8
                                                        },
                                                        {
                                                            "key": "1000000536",
                                                            "doc_count": 8
                                                        },
                                                        {
                                                            "key": "1000000250",
                                                            "doc_count": 6
                                                        },
                                                        {
                                                            "key": "1000000261",
                                                            "doc_count": 5
                                                        },
                                                        {
                                                            "key": "1000000789",
                                                            "doc_count": 5
                                                        },
                                                        {
                                                            "key": "1000000920",
                                                            "doc_count": 5
                                                        },
                                                        {
                                                            "key": "1000000042",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000110",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000156",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000173",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000188",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000201",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000228",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000244",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000279",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000360",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000377",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000469",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000763",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000771",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000817",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000914",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000986",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000022",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000024",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000045",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000056",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000099",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000101",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000135",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000151",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000160",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000166",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000207",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000245",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000278",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000285",
                                                            "doc_count": 3
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "聚合+日志": {
                                        "value": {
                                            "took": 2,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 1,
                                                "successful": 1,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 6,
                                                    "relation": "eq"
                                                },
                                                "max_score": 10.377605,
                                                "hits": [
                                                    {
                                                        "_index": "kc-0001",
                                                        "_type": "_doc",
                                                        "_id": "rzi8ynkBtjHaDF8osQXj",
                                                        "_score": 10.377605,
                                                        "_source": {
                                                            "version": "AISHUV0",
                                                            "TraceId": "",
                                                            "SpanId": "",
                                                            "ParentId": "",
                                                            "StartTime": "1621408854792",
                                                            "Attributes": {
                                                                "type": "sample logger test",
                                                                "Attribute": {
                                                                    "user.id": "ABC001",
                                                                    "user.dep": "",
                                                                    "act.type": "add topic",
                                                                    "topic.id": "1000000957",
                                                                    "act.category": "400000097",
                                                                    "act.label": "200000078,200000369,200000466"
                                                                }
                                                            },
                                                            "Resource": {
                                                                "service.name": "KC",
                                                                "service.version": "1.0.0",
                                                                "k8s.pod.uid": "1138528c-c36e-11e9-t235-42010a800198"
                                                            },
                                                            "Body": {
                                                                "Events": {

                                                                },
                                                                "Metrics": {

                                                                },
                                                                "ExternalSpan": {

                                                                }
                                                            },
                                                            "EndTime": ""
                                                        }
                                                    },
                                                    {
                                                        "_index": "kc-0001",
                                                        "_type": "_doc",
                                                        "_id": "0zi8ynkBtjHaDF8osQXj",
                                                        "_score": 10.377605,
                                                        "_source": {
                                                            "version": "AISHUV0",
                                                            "TraceId": "",
                                                            "SpanId": "",
                                                            "ParentId": "",
                                                            "StartTime": "1621408858599",
                                                            "Attributes": {
                                                                "type": "sample logger test",
                                                                "Attribute": {
                                                                    "user.id": "ABC001",
                                                                    "user.dep": "",
                                                                    "act.type": "add topic",
                                                                    "topic.id": "1000000571",
                                                                    "act.category": "400000093",
                                                                    "act.label": "200000038,200000078,200000067"
                                                                }
                                                            },
                                                            "Resource": {
                                                                "service.name": "KC",
                                                                "service.version": "1.0.0",
                                                                "k8s.pod.uid": "1138528c-c36e-11e9-t235-42010a800198"
                                                            },
                                                            "Body": {
                                                                "Events": {

                                                                },
                                                                "Metrics": {

                                                                },
                                                                "ExternalSpan": {

                                                                }
                                                            },
                                                            "EndTime": ""
                                                        }
                                                    }
                                                ]
                                            },
                                            "aggregations": {
                                                "count(sharedLink)": {
                                                    "doc_count_error_upper_bound": 0,
                                                    "sum_other_doc_count": 0,
                                                    "buckets": [
                                                        {
                                                            "key": "1000000375",
                                                            "doc_count": 1
                                                        },
                                                        {
                                                            "key": "1000000503",
                                                            "doc_count": 1
                                                        },
                                                        {
                                                            "key": "1000000571",
                                                            "doc_count": 1
                                                        },
                                                        {
                                                            "key": "1000000695",
                                                            "doc_count": 1
                                                        },
                                                        {
                                                            "key": "1000000822",
                                                            "doc_count": 1
                                                        },
                                                        {
                                                            "key": "1000000957",
                                                            "doc_count": 1
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "NoData": {
                                        "value": {
                                            "took": 2,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 1,
                                                "successful": 1,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 0,
                                                    "relation": "eq"
                                                },
                                                "hits": [
                                                ]
                                            },
                                            "aggregations": {
                                                "count(sharedLink)": {
                                                    "doc_count_error_upper_bound": 0,
                                                    "sum_other_doc_count": 0,
                                                    "buckets": [
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "聚合返回": {
                                        "value": {
                                            "took": 0,
                                            "timed_out": true,
                                            "_shards": {
                                                "total": 0,
                                                "successful": 0,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 0,
                                                    "relation": "string"
                                                },
                                                "hits": [
                                                    {

                                                    }
                                                ]
                                            },
                                            "aggregations": {
                                                "count(sharedLink)": {
                                                    "doc_count_error_upper_bound": 0,
                                                    "sum_other_doc_count": 0,
                                                    "buckets": [
                                                        {
                                                            "key": "string",
                                                            "doc_count": 0
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "top_hits返回": {
                                        "value": {
                                            "took": 5,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 1,
                                                "successful": 1,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 6,
                                                    "relation": "eq"
                                                },
                                                "hits": [
                                                ]
                                            },
                                            "aggregations": {
                                                "count(sharedLink)": {
                                                    "doc_count_error_upper_bound": 0,
                                                    "sum_other_doc_count": 0,
                                                    "buckets": [
                                                        {
                                                            "key": "1000000375",
                                                            "doc_count": 1,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 1,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "-Ti8ynkBtjHaDF8osQXj",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000117,200000046,200000270"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408862478
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "key": "1000000503",
                                                            "doc_count": 1,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 1,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "3Di8ynkBtjHaDF8osQXj",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000049,200000007,200000465"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408859479
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "key": "1000000571",
                                                            "doc_count": 1,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 1,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "0zi8ynkBtjHaDF8osQXj",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000038,200000078,200000067"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408858599
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "key": "1000000695",
                                                            "doc_count": 1,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 1,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "Aji8ynkBtjHaDF8osQbj",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000207,200000028,200000298"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408863295
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "key": "1000000822",
                                                            "doc_count": 1,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 1,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "BTi8ynkBtjHaDF8osQbj",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000189,200000347,200000340"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408863549
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "key": "1000000957",
                                                            "doc_count": 1,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 1,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "rzi8ynkBtjHaDF8osQXj",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000078,200000369,200000466"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408854792
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "部分失败": {
                                        "value": {
                                            "took": 20,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 2,
                                                "successful": 1,
                                                "skipped": 0,
                                                "failed": 1,
                                                "failures": [
                                                    {
                                                        "shard": 0,
                                                        "index": "test-001",
                                                        "node": "pRTH-IO2SWOP7cfKkzSP2w",
                                                        "reason": {
                                                            "type": "illegal_argument_exception",
                                                            "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [StartTime] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                        }
                                                    }
                                                ]
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 10000,
                                                    "relation": "gte"
                                                },
                                                "hits": [
                                                ]
                                            },
                                            "aggregations": {
                                                "count(sharedLink)": {
                                                    "doc_count_error_upper_bound": 0,
                                                    "sum_other_doc_count": 47795,
                                                    "buckets": [
                                                        {
                                                            "key": "upvote doc",
                                                            "doc_count": 2205,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 2205,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "dzi8ynkBtjHaDF8osS_n",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000249,200000483,200000187"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408866012
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "scroll滚动返回": {
                                        "value": {
                                            "_scroll_id": "FGluY2x1ZGVfY29udGV4dF91dWlkDnF1ZXJ5VGhlbkZldGNoBhRfWkZmUW5vQlRsOTFDMVZfa1VlUQAAAAAAAB08FlNoWHlMdDJJUXFHcmZjQ19hNnFEbkEUXzVGZlFub0JUbDkxQzFWX2tVZVEAAAAAAAAdPhZTaFh5THQySVFxR3JmY0NfYTZxRG5BFC01RmZRbm9CVGw5MUMxVl9rVWVRAAAAAAAAHToWU2hYeUx0MklRcUdyZmNDX2E2cURuQRRfSkZmUW5vQlRsOTFDMVZfa1VlUQAAAAAAAB07FlNoWHlMdDJJUXFHcmZjQ19hNnFEbkEUX3BGZlFub0JUbDkxQzFWX2tVZVEAAAAAAAAdPRZTaFh5THQySVFxR3JmY0NfYTZxRG5BFEFKRmZRbm9CVGw5MUMxVl9rVWlSAAAAAAAAHT8WU2hYeUx0MklRcUdyZmNDX2E2cURuQQ==",
                                            "took": 10,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 6,
                                                "successful": 6,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 2052,
                                                    "relation": "eq"
                                                },
                                                "max_score": 0,
                                                "hits": [
                                                    {
                                                        "_index": "kc-2021.05-0",
                                                        "_type": "_doc",
                                                        "_id": "Da4TonkBxG21l8yYptnO",
                                                        "_score": 0,
                                                        "_source": {
                                                            "host": "node214",
                                                            "arPort": 20015,
                                                            "@version": "1",
                                                            "Body": {
                                                                "ExternalSpan": {

                                                                },
                                                                "Events": {

                                                                },
                                                                "Metrics": {

                                                                }
                                                            },
                                                            "ParentId": "",
                                                            "message": "{\"Version\": \"AISHUV0\", \"TraceId\": \"\", \"SpanId\": \"\", \"ParentId\": \"\", \"StartTime\": \"1621408856003\", \"Attributes\": {\"type\": \"sample logger test\", \"Attribute\": {\"user.id\": \"ABC001\", \"user.dep\": \"\", \"act.type\": \"view doc\", \"topic.id\": \"1000000993\", \"doc.id\": \"300004415\", \"act.label\": \"200000250,200000341,200000455\"}}, \"Resource\": {\"service.name\": \"KC\", \"service.version\": \"1.0.0\", \"k8s.pod.uid\": \"1138528c-c36e-11e9-t235-42010a800198\"}, \"Body\": {\"Events\": {}, \"Metrics\": {}, \"ExternalSpan\": {}}, \"EndTime\": \"\"}\r",
                                                            "Attributes": {
                                                                "Attribute": {
                                                                    "act.type": "view doc",
                                                                    "user.id": "ABC001",
                                                                    "act.label": "200000250,200000341,200000455",
                                                                    "user.dep": "",
                                                                    "doc.id": "300004415",
                                                                    "topic.id": "1000000993"
                                                                },
                                                                "type": "sample logger test"
                                                            },
                                                            "@timestamp": "2021-05-25T05:51:06.730Z",
                                                            "Resource": {
                                                                "service.name": "KC",
                                                                "service.version": "1.0.0",
                                                                "k8s.pod.uid": "1138528c-c36e-11e9-t235-42010a800198"
                                                            },
                                                            "Version": "AISHUV0",
                                                            "TraceId": "",
                                                            "StartTime": "1621408856003",
                                                            "EndTime": "",
                                                            "ruleName": "KC推荐日志",
                                                            "SpanId": "",
                                                            "type": "kc",
                                                            "port": 52568
                                                        }
                                                    }
                                                ]
                                            },
                                            "aggregations": {
                                                "doc_id": {
                                                    "doc_count_error_upper_bound": 17,
                                                    "sum_other_doc_count": 1749,
                                                    "buckets": [
                                                        {
                                                            "key": "1000000645",
                                                            "doc_count": 45
                                                        },
                                                        {
                                                            "key": "1000000073",
                                                            "doc_count": 36
                                                        },
                                                        {
                                                            "key": "1000000220",
                                                            "doc_count": 35
                                                        },
                                                        {
                                                            "key": "1000000074",
                                                            "doc_count": 31
                                                        },
                                                        {
                                                            "key": "1000000195",
                                                            "doc_count": 31
                                                        },
                                                        {
                                                            "key": "1000000697",
                                                            "doc_count": 28
                                                        },
                                                        {
                                                            "key": "1000000503",
                                                            "doc_count": 26
                                                        },
                                                        {
                                                            "key": "1000000394",
                                                            "doc_count": 25
                                                        },
                                                        {
                                                            "key": "1000000141",
                                                            "doc_count": 23
                                                        },
                                                        {
                                                            "key": "1000000466",
                                                            "doc_count": 23
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "description": "OK"
                    },
                    "400": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/errorCode"
                                },
                                "examples": {
                                    "x_content_parse_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "x_content_parse_exception",
                                                        "reason": "[1:438] [bool] failed to parse field [must]"
                                                    }
                                                ],
                                                "type": "x_content_parse_exception",
                                                "reason": "[1:438] [bool] failed to parse field [must]",
                                                "caused_by": {
                                                    "type": "illegal_argument_exception",
                                                    "reason": "Invalid format: [epoch_milli]: Unknown pattern letter: o",
                                                    "caused_by": {
                                                        "type": "illegal_argument_exception",
                                                        "reason": "Unknown pattern letter: o"
                                                    }
                                                }
                                            },
                                            "status": 400
                                        }
                                    },
                                    "search_phase_execution_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "illegal_argument_exception",
                                                        "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                    }
                                                ],
                                                "type": "search_phase_execution_exception",
                                                "reason": "all shards failed",
                                                "phase": "query",
                                                "grouped": true,
                                                "failed_shards": [
                                                    {
                                                        "shard": 0,
                                                        "index": "kc-0001",
                                                        "node": "P3nWcjR6Tm2bnNp0y7iDrA",
                                                        "reason": {
                                                            "type": "illegal_argument_exception",
                                                            "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                        }
                                                    }
                                                ],
                                                "caused_by": {
                                                    "type": "illegal_argument_exception",
                                                    "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory.",
                                                    "caused_by": {
                                                        "type": "illegal_argument_exception",
                                                        "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                    }
                                                }
                                            },
                                            "status": 400
                                        }
                                    },
                                    "search_phase_execution_exception2": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "parse_exception",
                                                        "reason": "failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]: [failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]]"
                                                    }
                                                ],
                                                "type": "search_phase_execution_exception",
                                                "reason": "all shards failed",
                                                "phase": "query",
                                                "grouped": true,
                                                "failed_shards": [
                                                    {
                                                        "shard": 0,
                                                        "index": "kc-0001",
                                                        "node": "P3nWcjR6Tm2bnNp0y7iDrA",
                                                        "reason": {
                                                            "type": "parse_exception",
                                                            "reason": "failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]: [failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]]",
                                                            "caused_by": {
                                                                "type": "illegal_argument_exception",
                                                                "reason": "failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]",
                                                                "caused_by": {
                                                                    "type": "date_time_parse_exception",
                                                                    "reason": "Failed to parse with all enclosed parsers"
                                                                }
                                                            }
                                                        }
                                                    }
                                                ]
                                            },
                                            "status": 400
                                        }
                                    },
                                    "too_long_frame_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "too_long_frame_exception",
                                                        "reason": "An HTTP line is larger than 4096 bytes."
                                                    }
                                                ],
                                                "type": "too_long_frame_exception",
                                                "reason": "An HTTP line is larger than 4096 bytes."
                                            },
                                            "status": 400
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Bad Request"
                    },
                    "500": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/errorCode"
                                },
                                "examples": {
                                    "example-1": {
                                        "value": {
                                            "error": {
                                                "type": "internal_error_exception",
                                                "reason": "internal error",
                                                "caused_by": {
                                                    "type": "internal_error_exception",
                                                    "reason": "error connection"
                                                }
                                            },
                                            "status": 0
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Internal Server Error"
                    }
                },
                "summary": "dsl 搜索",
                "description": ""
            },
            "parameters": [
                {
                    "name": "x_library",
                    "description": "索引库名称，扩展参数，也可放于body中，都为空则默认返回空数据集，若两个都有，则取交集查询",
                    "schema": {
                        "type": "string"
                    },
                    "in": "path",
                    "required": true
                }
            ]
        },
        "/api/uniquery/v1/dsl/_search/": {
            "description": "",
            "post": {
                "requestBody": {
                    "description": "兼容elasticsearch 7.10.2 和opensearch 1.x的dsl查询语法",
                    "content": {
                        "application/json": {
                            "schema": {
                                "description": "dsl查询语句",
                                "type": "object",
                                "properties": {
                                    "x_library": {
                                        "description": "该参数为dsl之外的扩展参数，指定查询的索引库名称，和路径中一致，非必须参数，若路径和body中均无此参数，则默认空数据集返回，若两个都有，则取交集查询",
                                        "type": "array",
                                        "items": {

                                        }
                                    }
                                }
                            },
                            "examples": {
                                "示例dsl结构": {
                                    "value": {
                                        "aggs": {
                                            "2": {
                                                "date_histogram": {
                                                    "extended_bounds": {
                                                        "min": 0
                                                    },
                                                    "field": "@timestamp",
                                                    "interval": "1M",
                                                    "min_doc_count": 1,
                                                    "time_zone": "Asia/Shanghai"
                                                }
                                            }
                                        },
                                        "query": {
                                            "bool": {
                                                "must": {
                                                    "term": {
                                                        "Attributes.type.keyword": "sample logger test"
                                                    }
                                                },
                                                "filter": [
                                                    {
                                                        "term": {
                                                            "tags": "production"
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "type.keyword": "kclogs"
                                                        }
                                                    },
                                                    {
                                                        "range": {
                                                            "@timestamp": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss||strict_date_optional_time",
                                                                "gte": "2021-07-01T01:49:10.893Z",
                                                                "lt": "2021-07-08T01:49:10.893Z"
                                                            }
                                                        }
                                                    }
                                                ],
                                                "must_not": {
                                                    "range": {
                                                        "age": {
                                                            "gte": 10,
                                                            "lte": 20
                                                        }
                                                    }
                                                },
                                                "should": [
                                                    {
                                                        "term": {
                                                            "tags": "env1"
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "tags": "deployed"
                                                        }
                                                    }
                                                ],
                                                "minimum_should_match": 1
                                            }
                                        }
                                    }
                                },
                                "字段过滤+聚合": {
                                    "value": {
                                        "aggs": {
                                            "doc_id": {
                                                "terms": {
                                                    "field": "Attributes.Attribute.topic.id.keyword"
                                                }
                                            }
                                        },
                                        "query": {
                                            "bool": {
                                                "filter": [
                                                    {
                                                        "range": {
                                                            "StartTime": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss",
                                                                "gte": "2021-07-01 08:49:10",
                                                                "lt": "2021-07-08 08:49:10"
                                                            }
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "Attributes.Attribute.user.id.keyword": "ABC001"
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "Attributes.Attribute.act.type.keyword": "add topic"
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                },
                                "字段过滤+聚合(指定top)": {
                                    "value": {
                                        "aggs": {
                                            "count(sharedLink)": {
                                                "terms": {
                                                    "field": "sharedLink.keyword",
                                                    "order": {
                                                        "_count": "desc"
                                                    },
                                                    "shard_size": 200,
                                                    "size": 100
                                                }
                                            }
                                        },
                                        "query": {
                                            "bool": {
                                                "filter": [
                                                    {
                                                        "range": {
                                                            "StartTime": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss",
                                                                "gte": "1625100550000",
                                                                "lt": "1625705350000"
                                                            }
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "文档库type.keyword": "ABC001"
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "文档库id.keyword": "ABC001"
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                },
                                "top_hits": {
                                    "value": {
                                        "size": 0,
                                        "aggs": {
                                            "count(sharedLink)": {
                                                "terms": {
                                                    "field": "sharedLink.keyword",
                                                    "order": {
                                                        "_count": "desc"
                                                    },
                                                    "shard_size": "200",
                                                    "size": 100
                                                },
                                                "aggs": {
                                                    "top": {
                                                        "top_hits": {
                                                            "size": 1,
                                                            "sort": [
                                                                {
                                                                    "@timestamp": "desc"
                                                                }
                                                            ],
                                                            "_source": {
                                                                "include": [
                                                                    "共享地址url",
                                                                    "共享地址类型",
                                                                    "名称"
                                                                ]
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "query": {
                                            "bool": {
                                                "filter": [
                                                    {
                                                        "range": {
                                                            "StartTime": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss",
                                                                "gte": "2021-07-01T01:49:10.893Z",
                                                                "lt": "2021-07-08T01:49:10.893Z"
                                                            }
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "文档库id.keyword": "ABC001"
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                },
                                "索引库支持放于body中": {
                                    "value": {
                                        "x_library": [
                                            "kclogs",
                                            "shardlink"
                                        ],
                                        "size": 0,
                                        "aggs": {
                                            "count(sharedLink)": {
                                                "terms": {
                                                    "field": "sharedLink.keyword",
                                                    "order": {
                                                        "_count": "desc"
                                                    },
                                                    "shard_size": "200",
                                                    "size": 100
                                                },
                                                "aggs": {
                                                    "top": {
                                                        "top_hits": {
                                                            "size": 1,
                                                            "sort": [
                                                                {
                                                                    "@timestamp": "desc"
                                                                }
                                                            ],
                                                            "_source": {
                                                                "include": [
                                                                    "共享地址url",
                                                                    "共享地址类型",
                                                                    "名称"
                                                                ]
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "query": {
                                            "bool": {
                                                "filter": [
                                                    {
                                                        "range": {
                                                            "StartTime": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss",
                                                                "gte": "2021-07-01T01:49:10.893Z",
                                                                "lt": "2021-07-08T01:49:10.893Z"
                                                            }
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "文档库id.keyword": "ABC001"
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "parameters": [
                    {
                        "name": "scroll",
                        "description": "指定搜索为滚动分页查询，保留分页搜索上下文的有效时间（支持数字+时间单位s,m,h）最长不超过24h",
                        "schema": {
                            "type": "string"
                        },
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object"
                                },
                                "examples": {
                                    "去重统计指定topsize返回": {
                                        "value": {
                                            "took": 2,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 1,
                                                "successful": 1,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 2104,
                                                    "relation": "eq"
                                                },
                                                "hits": [
                                                ]
                                            },
                                            "aggregations": {
                                                "count(sharedLink)": {
                                                    "doc_count_error_upper_bound": 0,
                                                    "sum_other_doc_count": 744,
                                                    "buckets": [
                                                        {
                                                            "key": "1000000838",
                                                            "doc_count": 67
                                                        },
                                                        {
                                                            "key": "1000000196",
                                                            "doc_count": 64
                                                        },
                                                        {
                                                            "key": "1000000517",
                                                            "doc_count": 40
                                                        },
                                                        {
                                                            "key": "1000000119",
                                                            "doc_count": 30
                                                        },
                                                        {
                                                            "key": "1000000393",
                                                            "doc_count": 30
                                                        },
                                                        {
                                                            "key": "1000000502",
                                                            "doc_count": 29
                                                        },
                                                        {
                                                            "key": "1000000601",
                                                            "doc_count": 27
                                                        },
                                                        {
                                                            "key": "1000000639",
                                                            "doc_count": 27
                                                        },
                                                        {
                                                            "key": "1000000991",
                                                            "doc_count": 27
                                                        },
                                                        {
                                                            "key": "1000000544",
                                                            "doc_count": 26
                                                        },
                                                        {
                                                            "key": "1000000229",
                                                            "doc_count": 25
                                                        },
                                                        {
                                                            "key": "1000000021",
                                                            "doc_count": 24
                                                        },
                                                        {
                                                            "key": "1000000970",
                                                            "doc_count": 24
                                                        },
                                                        {
                                                            "key": "1000000596",
                                                            "doc_count": 23
                                                        },
                                                        {
                                                            "key": "1000000977",
                                                            "doc_count": 23
                                                        },
                                                        {
                                                            "key": "1000000200",
                                                            "doc_count": 22
                                                        },
                                                        {
                                                            "key": "1000000925",
                                                            "doc_count": 21
                                                        },
                                                        {
                                                            "key": "1000000358",
                                                            "doc_count": 20
                                                        },
                                                        {
                                                            "key": "1000000361",
                                                            "doc_count": 20
                                                        },
                                                        {
                                                            "key": "1000000468",
                                                            "doc_count": 20
                                                        },
                                                        {
                                                            "key": "1000000519",
                                                            "doc_count": 20
                                                        },
                                                        {
                                                            "key": "1000000613",
                                                            "doc_count": 20
                                                        },
                                                        {
                                                            "key": "1000000636",
                                                            "doc_count": 20
                                                        },
                                                        {
                                                            "key": "1000000419",
                                                            "doc_count": 19
                                                        },
                                                        {
                                                            "key": "1000000805",
                                                            "doc_count": 19
                                                        },
                                                        {
                                                            "key": "1000000820",
                                                            "doc_count": 19
                                                        },
                                                        {
                                                            "key": "1000000109",
                                                            "doc_count": 18
                                                        },
                                                        {
                                                            "key": "1000000009",
                                                            "doc_count": 17
                                                        },
                                                        {
                                                            "key": "1000000118",
                                                            "doc_count": 17
                                                        },
                                                        {
                                                            "key": "1000000132",
                                                            "doc_count": 17
                                                        },
                                                        {
                                                            "key": "1000000143",
                                                            "doc_count": 17
                                                        },
                                                        {
                                                            "key": "1000000342",
                                                            "doc_count": 17
                                                        },
                                                        {
                                                            "key": "1000000437",
                                                            "doc_count": 17
                                                        },
                                                        {
                                                            "key": "1000000146",
                                                            "doc_count": 16
                                                        },
                                                        {
                                                            "key": "1000000181",
                                                            "doc_count": 16
                                                        },
                                                        {
                                                            "key": "1000000202",
                                                            "doc_count": 16
                                                        },
                                                        {
                                                            "key": "1000000340",
                                                            "doc_count": 16
                                                        },
                                                        {
                                                            "key": "1000000370",
                                                            "doc_count": 16
                                                        },
                                                        {
                                                            "key": "1000000703",
                                                            "doc_count": 16
                                                        },
                                                        {
                                                            "key": "1000000407",
                                                            "doc_count": 15
                                                        },
                                                        {
                                                            "key": "1000000662",
                                                            "doc_count": 15
                                                        },
                                                        {
                                                            "key": "1000000673",
                                                            "doc_count": 15
                                                        },
                                                        {
                                                            "key": "1000000866",
                                                            "doc_count": 15
                                                        },
                                                        {
                                                            "key": "1000000557",
                                                            "doc_count": 14
                                                        },
                                                        {
                                                            "key": "1000000808",
                                                            "doc_count": 14
                                                        },
                                                        {
                                                            "key": "1000000821",
                                                            "doc_count": 14
                                                        },
                                                        {
                                                            "key": "1000000835",
                                                            "doc_count": 14
                                                        },
                                                        {
                                                            "key": "1000000576",
                                                            "doc_count": 13
                                                        },
                                                        {
                                                            "key": "1000000686",
                                                            "doc_count": 13
                                                        },
                                                        {
                                                            "key": "1000000815",
                                                            "doc_count": 13
                                                        },
                                                        {
                                                            "key": "1000000141",
                                                            "doc_count": 12
                                                        },
                                                        {
                                                            "key": "1000000485",
                                                            "doc_count": 12
                                                        },
                                                        {
                                                            "key": "1000000714",
                                                            "doc_count": 12
                                                        },
                                                        {
                                                            "key": "1000000742",
                                                            "doc_count": 12
                                                        },
                                                        {
                                                            "key": "1000000895",
                                                            "doc_count": 12
                                                        },
                                                        {
                                                            "key": "1000000087",
                                                            "doc_count": 10
                                                        },
                                                        {
                                                            "key": "1000000263",
                                                            "doc_count": 10
                                                        },
                                                        {
                                                            "key": "1000000496",
                                                            "doc_count": 10
                                                        },
                                                        {
                                                            "key": "1000000741",
                                                            "doc_count": 10
                                                        },
                                                        {
                                                            "key": "1000000881",
                                                            "doc_count": 10
                                                        },
                                                        {
                                                            "key": "1000000516",
                                                            "doc_count": 9
                                                        },
                                                        {
                                                            "key": "1000000732",
                                                            "doc_count": 9
                                                        },
                                                        {
                                                            "key": "1000000398",
                                                            "doc_count": 8
                                                        },
                                                        {
                                                            "key": "1000000503",
                                                            "doc_count": 8
                                                        },
                                                        {
                                                            "key": "1000000536",
                                                            "doc_count": 8
                                                        },
                                                        {
                                                            "key": "1000000250",
                                                            "doc_count": 6
                                                        },
                                                        {
                                                            "key": "1000000261",
                                                            "doc_count": 5
                                                        },
                                                        {
                                                            "key": "1000000789",
                                                            "doc_count": 5
                                                        },
                                                        {
                                                            "key": "1000000920",
                                                            "doc_count": 5
                                                        },
                                                        {
                                                            "key": "1000000042",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000110",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000156",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000173",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000188",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000201",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000228",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000244",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000279",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000360",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000377",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000469",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000763",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000771",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000817",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000914",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000986",
                                                            "doc_count": 4
                                                        },
                                                        {
                                                            "key": "1000000022",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000024",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000045",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000056",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000099",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000101",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000135",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000151",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000160",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000166",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000207",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000245",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000278",
                                                            "doc_count": 3
                                                        },
                                                        {
                                                            "key": "1000000285",
                                                            "doc_count": 3
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "聚合+日志": {
                                        "value": {
                                            "took": 2,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 1,
                                                "successful": 1,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 6,
                                                    "relation": "eq"
                                                },
                                                "max_score": 10.377605,
                                                "hits": [
                                                    {
                                                        "_index": "kc-0001",
                                                        "_type": "_doc",
                                                        "_id": "rzi8ynkBtjHaDF8osQXj",
                                                        "_score": 10.377605,
                                                        "_source": {
                                                            "version": "AISHUV0",
                                                            "TraceId": "",
                                                            "SpanId": "",
                                                            "ParentId": "",
                                                            "StartTime": "1621408854792",
                                                            "Attributes": {
                                                                "type": "sample logger test",
                                                                "Attribute": {
                                                                    "user.id": "ABC001",
                                                                    "user.dep": "",
                                                                    "act.type": "add topic",
                                                                    "topic.id": "1000000957",
                                                                    "act.category": "400000097",
                                                                    "act.label": "200000078,200000369,200000466"
                                                                }
                                                            },
                                                            "Resource": {
                                                                "service.name": "KC",
                                                                "service.version": "1.0.0",
                                                                "k8s.pod.uid": "1138528c-c36e-11e9-t235-42010a800198"
                                                            },
                                                            "Body": {
                                                                "Events": {

                                                                },
                                                                "Metrics": {

                                                                },
                                                                "ExternalSpan": {

                                                                }
                                                            },
                                                            "EndTime": ""
                                                        }
                                                    },
                                                    {
                                                        "_index": "kc-0001",
                                                        "_type": "_doc",
                                                        "_id": "0zi8ynkBtjHaDF8osQXj",
                                                        "_score": 10.377605,
                                                        "_source": {
                                                            "version": "AISHUV0",
                                                            "TraceId": "",
                                                            "SpanId": "",
                                                            "ParentId": "",
                                                            "StartTime": "1621408858599",
                                                            "Attributes": {
                                                                "type": "sample logger test",
                                                                "Attribute": {
                                                                    "user.id": "ABC001",
                                                                    "user.dep": "",
                                                                    "act.type": "add topic",
                                                                    "topic.id": "1000000571",
                                                                    "act.category": "400000093",
                                                                    "act.label": "200000038,200000078,200000067"
                                                                }
                                                            },
                                                            "Resource": {
                                                                "service.name": "KC",
                                                                "service.version": "1.0.0",
                                                                "k8s.pod.uid": "1138528c-c36e-11e9-t235-42010a800198"
                                                            },
                                                            "Body": {
                                                                "Events": {

                                                                },
                                                                "Metrics": {

                                                                },
                                                                "ExternalSpan": {

                                                                }
                                                            },
                                                            "EndTime": ""
                                                        }
                                                    }
                                                ]
                                            },
                                            "aggregations": {
                                                "count(sharedLink)": {
                                                    "doc_count_error_upper_bound": 0,
                                                    "sum_other_doc_count": 0,
                                                    "buckets": [
                                                        {
                                                            "key": "1000000375",
                                                            "doc_count": 1
                                                        },
                                                        {
                                                            "key": "1000000503",
                                                            "doc_count": 1
                                                        },
                                                        {
                                                            "key": "1000000571",
                                                            "doc_count": 1
                                                        },
                                                        {
                                                            "key": "1000000695",
                                                            "doc_count": 1
                                                        },
                                                        {
                                                            "key": "1000000822",
                                                            "doc_count": 1
                                                        },
                                                        {
                                                            "key": "1000000957",
                                                            "doc_count": 1
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "NoData": {
                                        "value": {
                                            "took": 2,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 1,
                                                "successful": 1,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 0,
                                                    "relation": "eq"
                                                },
                                                "hits": [
                                                ]
                                            },
                                            "aggregations": {
                                                "count(sharedLink)": {
                                                    "doc_count_error_upper_bound": 0,
                                                    "sum_other_doc_count": 0,
                                                    "buckets": [
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "聚合返回": {
                                        "value": {
                                            "took": 0,
                                            "timed_out": true,
                                            "_shards": {
                                                "total": 0,
                                                "successful": 0,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 0,
                                                    "relation": "string"
                                                },
                                                "hits": [
                                                    {

                                                    }
                                                ]
                                            },
                                            "aggregations": {
                                                "count(sharedLink)": {
                                                    "doc_count_error_upper_bound": 0,
                                                    "sum_other_doc_count": 0,
                                                    "buckets": [
                                                        {
                                                            "key": "string",
                                                            "doc_count": 0
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "top_hits返回": {
                                        "value": {
                                            "took": 5,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 1,
                                                "successful": 1,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 6,
                                                    "relation": "eq"
                                                },
                                                "hits": [
                                                ]
                                            },
                                            "aggregations": {
                                                "count(sharedLink)": {
                                                    "doc_count_error_upper_bound": 0,
                                                    "sum_other_doc_count": 0,
                                                    "buckets": [
                                                        {
                                                            "key": "1000000375",
                                                            "doc_count": 1,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 1,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "-Ti8ynkBtjHaDF8osQXj",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000117,200000046,200000270"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408862478
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "key": "1000000503",
                                                            "doc_count": 1,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 1,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "3Di8ynkBtjHaDF8osQXj",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000049,200000007,200000465"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408859479
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "key": "1000000571",
                                                            "doc_count": 1,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 1,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "0zi8ynkBtjHaDF8osQXj",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000038,200000078,200000067"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408858599
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "key": "1000000695",
                                                            "doc_count": 1,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 1,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "Aji8ynkBtjHaDF8osQbj",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000207,200000028,200000298"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408863295
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "key": "1000000822",
                                                            "doc_count": 1,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 1,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "BTi8ynkBtjHaDF8osQbj",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000189,200000347,200000340"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408863549
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "key": "1000000957",
                                                            "doc_count": 1,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 1,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "rzi8ynkBtjHaDF8osQXj",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000078,200000369,200000466"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408854792
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "部分失败": {
                                        "value": {
                                            "took": 20,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 2,
                                                "successful": 1,
                                                "skipped": 0,
                                                "failed": 1,
                                                "failures": [
                                                    {
                                                        "shard": 0,
                                                        "index": "test-001",
                                                        "node": "pRTH-IO2SWOP7cfKkzSP2w",
                                                        "reason": {
                                                            "type": "illegal_argument_exception",
                                                            "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [StartTime] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                        }
                                                    }
                                                ]
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 10000,
                                                    "relation": "gte"
                                                },
                                                "hits": [
                                                ]
                                            },
                                            "aggregations": {
                                                "count(sharedLink)": {
                                                    "doc_count_error_upper_bound": 0,
                                                    "sum_other_doc_count": 47795,
                                                    "buckets": [
                                                        {
                                                            "key": "upvote doc",
                                                            "doc_count": 2205,
                                                            "top": {
                                                                "hits": {
                                                                    "total": {
                                                                        "value": 2205,
                                                                        "relation": "eq"
                                                                    },
                                                                    "hits": [
                                                                        {
                                                                            "_index": "kc-0001",
                                                                            "_type": "_doc",
                                                                            "_id": "dzi8ynkBtjHaDF8osS_n",
                                                                            "_source": {
                                                                                "Attributes": {
                                                                                    "Attribute": {
                                                                                        "act.label": "200000249,200000483,200000187"
                                                                                    },
                                                                                    "type": "sample logger test"
                                                                                }
                                                                            },
                                                                            "sort": [
                                                                                1621408866012
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "scroll滚动返回": {
                                        "value": {
                                            "_scroll_id": "FGluY2x1ZGVfY29udGV4dF91dWlkDnF1ZXJ5VGhlbkZldGNoBhRfWkZmUW5vQlRsOTFDMVZfa1VlUQAAAAAAAB08FlNoWHlMdDJJUXFHcmZjQ19hNnFEbkEUXzVGZlFub0JUbDkxQzFWX2tVZVEAAAAAAAAdPhZTaFh5THQySVFxR3JmY0NfYTZxRG5BFC01RmZRbm9CVGw5MUMxVl9rVWVRAAAAAAAAHToWU2hYeUx0MklRcUdyZmNDX2E2cURuQRRfSkZmUW5vQlRsOTFDMVZfa1VlUQAAAAAAAB07FlNoWHlMdDJJUXFHcmZjQ19hNnFEbkEUX3BGZlFub0JUbDkxQzFWX2tVZVEAAAAAAAAdPRZTaFh5THQySVFxR3JmY0NfYTZxRG5BFEFKRmZRbm9CVGw5MUMxVl9rVWlSAAAAAAAAHT8WU2hYeUx0MklRcUdyZmNDX2E2cURuQQ==",
                                            "took": 10,
                                            "timed_out": false,
                                            "_shards": {
                                                "total": 6,
                                                "successful": 6,
                                                "skipped": 0,
                                                "failed": 0
                                            },
                                            "hits": {
                                                "total": {
                                                    "value": 2052,
                                                    "relation": "eq"
                                                },
                                                "max_score": 0,
                                                "hits": [
                                                    {
                                                        "_index": "kc-2021.05-0",
                                                        "_type": "_doc",
                                                        "_id": "Da4TonkBxG21l8yYptnO",
                                                        "_score": 0,
                                                        "_source": {
                                                            "host": "node214",
                                                            "arPort": 20015,
                                                            "@version": "1",
                                                            "Body": {
                                                                "ExternalSpan": {

                                                                },
                                                                "Events": {

                                                                },
                                                                "Metrics": {

                                                                }
                                                            },
                                                            "ParentId": "",
                                                            "message": "{\"Version\": \"AISHUV0\", \"TraceId\": \"\", \"SpanId\": \"\", \"ParentId\": \"\", \"StartTime\": \"1621408856003\", \"Attributes\": {\"type\": \"sample logger test\", \"Attribute\": {\"user.id\": \"ABC001\", \"user.dep\": \"\", \"act.type\": \"view doc\", \"topic.id\": \"1000000993\", \"doc.id\": \"300004415\", \"act.label\": \"200000250,200000341,200000455\"}}, \"Resource\": {\"service.name\": \"KC\", \"service.version\": \"1.0.0\", \"k8s.pod.uid\": \"1138528c-c36e-11e9-t235-42010a800198\"}, \"Body\": {\"Events\": {}, \"Metrics\": {}, \"ExternalSpan\": {}}, \"EndTime\": \"\"}\r",
                                                            "Attributes": {
                                                                "Attribute": {
                                                                    "act.type": "view doc",
                                                                    "user.id": "ABC001",
                                                                    "act.label": "200000250,200000341,200000455",
                                                                    "user.dep": "",
                                                                    "doc.id": "300004415",
                                                                    "topic.id": "1000000993"
                                                                },
                                                                "type": "sample logger test"
                                                            },
                                                            "@timestamp": "2021-05-25T05:51:06.730Z",
                                                            "Resource": {
                                                                "service.name": "KC",
                                                                "service.version": "1.0.0",
                                                                "k8s.pod.uid": "1138528c-c36e-11e9-t235-42010a800198"
                                                            },
                                                            "Version": "AISHUV0",
                                                            "TraceId": "",
                                                            "StartTime": "1621408856003",
                                                            "EndTime": "",
                                                            "ruleName": "KC推荐日志",
                                                            "SpanId": "",
                                                            "type": "kc",
                                                            "port": 52568
                                                        }
                                                    }
                                                ]
                                            },
                                            "aggregations": {
                                                "doc_id": {
                                                    "doc_count_error_upper_bound": 17,
                                                    "sum_other_doc_count": 1749,
                                                    "buckets": [
                                                        {
                                                            "key": "1000000645",
                                                            "doc_count": 45
                                                        },
                                                        {
                                                            "key": "1000000073",
                                                            "doc_count": 36
                                                        },
                                                        {
                                                            "key": "1000000220",
                                                            "doc_count": 35
                                                        },
                                                        {
                                                            "key": "1000000074",
                                                            "doc_count": 31
                                                        },
                                                        {
                                                            "key": "1000000195",
                                                            "doc_count": 31
                                                        },
                                                        {
                                                            "key": "1000000697",
                                                            "doc_count": 28
                                                        },
                                                        {
                                                            "key": "1000000503",
                                                            "doc_count": 26
                                                        },
                                                        {
                                                            "key": "1000000394",
                                                            "doc_count": 25
                                                        },
                                                        {
                                                            "key": "1000000141",
                                                            "doc_count": 23
                                                        },
                                                        {
                                                            "key": "1000000466",
                                                            "doc_count": 23
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "description": "OK"
                    },
                    "400": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/errorCode"
                                },
                                "examples": {
                                    "x_content_parse_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "x_content_parse_exception",
                                                        "reason": "[1:438] [bool] failed to parse field [must]"
                                                    }
                                                ],
                                                "type": "x_content_parse_exception",
                                                "reason": "[1:438] [bool] failed to parse field [must]",
                                                "caused_by": {
                                                    "type": "illegal_argument_exception",
                                                    "reason": "Invalid format: [epoch_milli]: Unknown pattern letter: o",
                                                    "caused_by": {
                                                        "type": "illegal_argument_exception",
                                                        "reason": "Unknown pattern letter: o"
                                                    }
                                                }
                                            },
                                            "status": 400
                                        }
                                    },
                                    "search_phase_execution_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "illegal_argument_exception",
                                                        "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                    }
                                                ],
                                                "type": "search_phase_execution_exception",
                                                "reason": "all shards failed",
                                                "phase": "query",
                                                "grouped": true,
                                                "failed_shards": [
                                                    {
                                                        "shard": 0,
                                                        "index": "kc-0001",
                                                        "node": "P3nWcjR6Tm2bnNp0y7iDrA",
                                                        "reason": {
                                                            "type": "illegal_argument_exception",
                                                            "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                        }
                                                    }
                                                ],
                                                "caused_by": {
                                                    "type": "illegal_argument_exception",
                                                    "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory.",
                                                    "caused_by": {
                                                        "type": "illegal_argument_exception",
                                                        "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                    }
                                                }
                                            },
                                            "status": 400
                                        }
                                    },
                                    "search_phase_execution_exception2": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "parse_exception",
                                                        "reason": "failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]: [failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]]"
                                                    }
                                                ],
                                                "type": "search_phase_execution_exception",
                                                "reason": "all shards failed",
                                                "phase": "query",
                                                "grouped": true,
                                                "failed_shards": [
                                                    {
                                                        "shard": 0,
                                                        "index": "kc-0001",
                                                        "node": "P3nWcjR6Tm2bnNp0y7iDrA",
                                                        "reason": {
                                                            "type": "parse_exception",
                                                            "reason": "failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]: [failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]]",
                                                            "caused_by": {
                                                                "type": "illegal_argument_exception",
                                                                "reason": "failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]",
                                                                "caused_by": {
                                                                    "type": "date_time_parse_exception",
                                                                    "reason": "Failed to parse with all enclosed parsers"
                                                                }
                                                            }
                                                        }
                                                    }
                                                ]
                                            },
                                            "status": 400
                                        }
                                    },
                                    "too_long_frame_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "too_long_frame_exception",
                                                        "reason": "An HTTP line is larger than 4096 bytes."
                                                    }
                                                ],
                                                "type": "too_long_frame_exception",
                                                "reason": "An HTTP line is larger than 4096 bytes."
                                            },
                                            "status": 400
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Bad Request"
                    },
                    "500": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/errorCode"
                                },
                                "examples": {
                                    "example-1": {
                                        "value": {
                                            "error": {
                                                "type": "internal_error_exception",
                                                "reason": "internal error",
                                                "caused_by": {
                                                    "type": "internal_error_exception",
                                                    "reason": "error connection"
                                                }
                                            },
                                            "status": 0
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Internal Server Error"
                    }
                },
                "summary": "dsl 搜索",
                "description": ""
            },
            "parameters": [
                {
                    "name": "x_library",
                    "description": "索引库名称，扩展参数，也可放于body中，都为空则默认返回空数据集，若两个都有，则取交集查询",
                    "schema": {
                        "type": "string"
                    },
                    "in": "path",
                    "required": true
                }
            ]
        },
        "/api/uniquery/v1/dsl/{x_library}/_count": {
            "description": "",
            "post": {
                "requestBody": {
                    "description": "兼容elasticsearch 7.10.2 和opensearch 1.x的dsl查询语法",
                    "content": {
                        "application/json": {
                            "schema": {
                                "description": "dsl查询语句",
                                "type": "object",
                                "properties": {
                                    "x_library": {
                                        "description": "该参数为dsl之外的扩展参数，指定查询的索引库名称，和路径中一致，非必须参数，若路径和body中均无此参数，则默认空数据集返回，若两个都有，则取交集查询",
                                        "type": "array",
                                        "items": {

                                        }
                                    }
                                }
                            },
                            "examples": {
                                "示例dsl结构": {
                                    "value": {
                                        "query": {
                                            "bool": {
                                                "must": {
                                                    "term": {
                                                        "Attributes.type.keyword": "sample logger test"
                                                    }
                                                },
                                                "filter": [
                                                    {
                                                        "term": {
                                                            "tags": "production"
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "type.keyword": "kclogs"
                                                        }
                                                    },
                                                    {
                                                        "range": {
                                                            "@timestamp": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss||strict_date_optional_time",
                                                                "gte": "2021-07-01T01:49:10.893Z",
                                                                "lt": "2021-07-08T01:49:10.893Z"
                                                            }
                                                        }
                                                    }
                                                ],
                                                "must_not": {
                                                    "range": {
                                                        "age": {
                                                            "gte": 10,
                                                            "lte": 20
                                                        }
                                                    }
                                                },
                                                "should": [
                                                    {
                                                        "term": {
                                                            "tags": "env1"
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "tags": "deployed"
                                                        }
                                                    }
                                                ],
                                                "minimum_should_match": 1
                                            }
                                        }
                                    }
                                },
                                "索引库支持放于body中": {
                                    "value": {
                                        "x_library": [
                                            "kclogs",
                                            "shardlink"
                                        ],
                                        "query": {
                                            "bool": {
                                                "filter": [
                                                    {
                                                        "range": {
                                                            "StartTime": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss",
                                                                "gte": "2021-07-01T01:49:10.893Z",
                                                                "lt": "2021-07-08T01:49:10.893Z"
                                                            }
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "文档库id.keyword": "ABC001"
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object"
                                },
                                "examples": {
                                    "示例dsl结构": {
                                        "value": {
                                            "count": 0,
                                            "_shards": {
                                                "total": 4,
                                                "successful": 4,
                                                "skipped": 0,
                                                "failed": 0
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "description": "OK"
                    },
                    "400": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/errorCode"
                                },
                                "examples": {
                                    "x_content_parse_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "x_content_parse_exception",
                                                        "reason": "[1:438] [bool] failed to parse field [must]"
                                                    }
                                                ],
                                                "type": "x_content_parse_exception",
                                                "reason": "[1:438] [bool] failed to parse field [must]",
                                                "caused_by": {
                                                    "type": "illegal_argument_exception",
                                                    "reason": "Invalid format: [epoch_milli]: Unknown pattern letter: o",
                                                    "caused_by": {
                                                        "type": "illegal_argument_exception",
                                                        "reason": "Unknown pattern letter: o"
                                                    }
                                                }
                                            },
                                            "status": 400
                                        }
                                    },
                                    "search_phase_execution_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "illegal_argument_exception",
                                                        "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                    }
                                                ],
                                                "type": "search_phase_execution_exception",
                                                "reason": "all shards failed",
                                                "phase": "query",
                                                "grouped": true,
                                                "failed_shards": [
                                                    {
                                                        "shard": 0,
                                                        "index": "kc-0001",
                                                        "node": "P3nWcjR6Tm2bnNp0y7iDrA",
                                                        "reason": {
                                                            "type": "illegal_argument_exception",
                                                            "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                        }
                                                    }
                                                ],
                                                "caused_by": {
                                                    "type": "illegal_argument_exception",
                                                    "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory.",
                                                    "caused_by": {
                                                        "type": "illegal_argument_exception",
                                                        "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                    }
                                                }
                                            },
                                            "status": 400
                                        }
                                    },
                                    "search_phase_execution_exception2": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "parse_exception",
                                                        "reason": "failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]: [failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]]"
                                                    }
                                                ],
                                                "type": "search_phase_execution_exception",
                                                "reason": "all shards failed",
                                                "phase": "query",
                                                "grouped": true,
                                                "failed_shards": [
                                                    {
                                                        "shard": 0,
                                                        "index": "kc-0001",
                                                        "node": "P3nWcjR6Tm2bnNp0y7iDrA",
                                                        "reason": {
                                                            "type": "parse_exception",
                                                            "reason": "failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]: [failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]]",
                                                            "caused_by": {
                                                                "type": "illegal_argument_exception",
                                                                "reason": "failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]",
                                                                "caused_by": {
                                                                    "type": "date_time_parse_exception",
                                                                    "reason": "Failed to parse with all enclosed parsers"
                                                                }
                                                            }
                                                        }
                                                    }
                                                ]
                                            },
                                            "status": 400
                                        }
                                    },
                                    "too_long_frame_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "too_long_frame_exception",
                                                        "reason": "An HTTP line is larger than 4096 bytes."
                                                    }
                                                ],
                                                "type": "too_long_frame_exception",
                                                "reason": "An HTTP line is larger than 4096 bytes."
                                            },
                                            "status": 400
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Bad Request"
                    },
                    "500": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/errorCode"
                                },
                                "examples": {
                                    "example-1": {
                                        "value": {
                                            "error": {
                                                "type": "internal_error_exception",
                                                "reason": "internal error",
                                                "caused_by": {
                                                    "type": "internal_error_exception",
                                                    "reason": "error connection"
                                                }
                                            },
                                            "status": 0
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Internal Server Error"
                    }
                },
                "summary": "dsl 查询总数",
                "description": ""
            },
            "parameters": [
                {
                    "name": "x_library",
                    "description": "索引库名称，扩展参数，也可放于body中，都为空则默认返回空数据集，若两个都有，则取交集查询",
                    "schema": {
                        "type": "string"
                    },
                    "in": "path",
                    "required": true
                }
            ]
        },
        "/api/uniquery/v1/dsl/_count": {
            "description": "",
            "post": {
                "requestBody": {
                    "description": "兼容elasticsearch 7.10.2 和opensearch 1.x的dsl查询语法",
                    "content": {
                        "application/json": {
                            "schema": {
                                "description": "dsl查询语句",
                                "type": "object",
                                "properties": {
                                    "x_library": {
                                        "description": "该参数为dsl之外的扩展参数，指定查询的索引库名称，和路径中一致，非必须参数，若body中均无此参数，则默认空数据集返回",
                                        "type": "array",
                                        "items": {

                                        }
                                    }
                                }
                            },
                            "examples": {
                                "示例dsl结构": {
                                    "value": {
                                        "query": {
                                            "bool": {
                                                "must": {
                                                    "term": {
                                                        "Attributes.type.keyword": "sample logger test"
                                                    }
                                                },
                                                "filter": [
                                                    {
                                                        "term": {
                                                            "tags": "production"
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "type.keyword": "kclogs"
                                                        }
                                                    },
                                                    {
                                                        "range": {
                                                            "@timestamp": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss||strict_date_optional_time",
                                                                "gte": "2021-07-01T01:49:10.893Z",
                                                                "lt": "2021-07-08T01:49:10.893Z"
                                                            }
                                                        }
                                                    }
                                                ],
                                                "must_not": {
                                                    "range": {
                                                        "age": {
                                                            "gte": 10,
                                                            "lte": 20
                                                        }
                                                    }
                                                },
                                                "should": [
                                                    {
                                                        "term": {
                                                            "tags": "env1"
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "tags": "deployed"
                                                        }
                                                    }
                                                ],
                                                "minimum_should_match": 1
                                            }
                                        }
                                    }
                                },
                                "索引库支持放于body中": {
                                    "value": {
                                        "x_library": [
                                            "kclogs",
                                            "shardlink"
                                        ],
                                        "query": {
                                            "bool": {
                                                "filter": [
                                                    {
                                                        "range": {
                                                            "StartTime": {
                                                                "format": "epoch_millis||yyyy-MM-dd HH:mm:ss",
                                                                "gte": "2021-07-01T01:49:10.893Z",
                                                                "lt": "2021-07-08T01:49:10.893Z"
                                                            }
                                                        }
                                                    },
                                                    {
                                                        "term": {
                                                            "文档库id.keyword": "ABC001"
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object"
                                },
                                "examples": {
                                    "示例dsl结构": {
                                        "value": {
                                            "count": 0,
                                            "_shards": {
                                                "total": 4,
                                                "successful": 4,
                                                "skipped": 0,
                                                "failed": 0
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "description": "OK"
                    },
                    "400": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/errorCode"
                                },
                                "examples": {
                                    "x_content_parse_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "x_content_parse_exception",
                                                        "reason": "[1:438] [bool] failed to parse field [must]"
                                                    }
                                                ],
                                                "type": "x_content_parse_exception",
                                                "reason": "[1:438] [bool] failed to parse field [must]",
                                                "caused_by": {
                                                    "type": "illegal_argument_exception",
                                                    "reason": "Invalid format: [epoch_milli]: Unknown pattern letter: o",
                                                    "caused_by": {
                                                        "type": "illegal_argument_exception",
                                                        "reason": "Unknown pattern letter: o"
                                                    }
                                                }
                                            },
                                            "status": 400
                                        }
                                    },
                                    "search_phase_execution_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "illegal_argument_exception",
                                                        "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                    }
                                                ],
                                                "type": "search_phase_execution_exception",
                                                "reason": "all shards failed",
                                                "phase": "query",
                                                "grouped": true,
                                                "failed_shards": [
                                                    {
                                                        "shard": 0,
                                                        "index": "kc-0001",
                                                        "node": "P3nWcjR6Tm2bnNp0y7iDrA",
                                                        "reason": {
                                                            "type": "illegal_argument_exception",
                                                            "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                        }
                                                    }
                                                ],
                                                "caused_by": {
                                                    "type": "illegal_argument_exception",
                                                    "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory.",
                                                    "caused_by": {
                                                        "type": "illegal_argument_exception",
                                                        "reason": "Text fields are not optimised for operations that require per-document field data like aggregations and sorting, so these operations are disabled by default. Please use a keyword field instead. Alternatively, set fielddata=true on [Attributes.Attribute.topic.id] in order to load field data by uninverting the inverted index. Note that this can use significant memory."
                                                    }
                                                }
                                            },
                                            "status": 400
                                        }
                                    },
                                    "search_phase_execution_exception2": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "parse_exception",
                                                        "reason": "failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]: [failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]]"
                                                    }
                                                ],
                                                "type": "search_phase_execution_exception",
                                                "reason": "all shards failed",
                                                "phase": "query",
                                                "grouped": true,
                                                "failed_shards": [
                                                    {
                                                        "shard": 0,
                                                        "index": "kc-0001",
                                                        "node": "P3nWcjR6Tm2bnNp0y7iDrA",
                                                        "reason": {
                                                            "type": "parse_exception",
                                                            "reason": "failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]: [failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]]",
                                                            "caused_by": {
                                                                "type": "illegal_argument_exception",
                                                                "reason": "failed to parse date field [2021-06-01 24:59:59] with format [epoch_millis||yyyy-MM-dd HH:mm:ss]",
                                                                "caused_by": {
                                                                    "type": "date_time_parse_exception",
                                                                    "reason": "Failed to parse with all enclosed parsers"
                                                                }
                                                            }
                                                        }
                                                    }
                                                ]
                                            },
                                            "status": 400
                                        }
                                    },
                                    "too_long_frame_exception": {
                                        "value": {
                                            "error": {
                                                "root_cause": [
                                                    {
                                                        "type": "too_long_frame_exception",
                                                        "reason": "An HTTP line is larger than 4096 bytes."
                                                    }
                                                ],
                                                "type": "too_long_frame_exception",
                                                "reason": "An HTTP line is larger than 4096 bytes."
                                            },
                                            "status": 400
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Bad Request"
                    },
                    "500": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/errorCode"
                                },
                                "examples": {
                                    "example-1": {
                                        "value": {
                                            "error": {
                                                "type": "internal_error_exception",
                                                "reason": "internal error",
                                                "caused_by": {
                                                    "type": "internal_error_exception",
                                                    "reason": "error connection"
                                                }
                                            },
                                            "status": 0
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Internal Server Error"
                    }
                },
                "summary": "dsl 查询总数",
                "description": ""
            }
        },
        "/api/uniquery/v1/promql/query": {
            "summary": "promql query",
            "description": "promql 瞬时值查询",
            "post": {
                "requestBody": {
                    "content": {
                        "application/x-www-form-urlencoded": {
                            "schema": {
                                "description": "promql 查询语句",
                                "type": "object",
                                "properties": {
                                    "query": {
                                        "description": "promql 查询语句. 必须. time()",
                                        "type": "string"
                                    },
                                    "timeout": {
                                        "description": "时间戳设置. 默认单位是秒, 非必须. time=1653619369.807",
                                        "type": "Number"
                                    }
                                }
                            },
                            "examples": {
                                "时间序列选择器": {
                                    "value": "query=time()&time=1652323553"
                                },
                                "time 参数错误": {
                                    "value": "query=time()&time=165232355g"
                                }
                            }
                        }
                    },
                    "required": true
                },
                "responses": {
                    "200": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object"
                                },
                                "examples": {
                                    "时间序列选择器": {
                                        "value": {
                                            "status": "success",
                                            "data": {
                                                "resultType": "scalar",
                                                "result": [
                                                    [
                                                        1652323553,
                                                        "1652323553"
                                                    ]
                                                ]
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/promqlErrorCode"
                                },
                                "examples": {
                                    "start 参数错误": {
                                        "value": {
                                            "status": "error",
                                            "errorType": "bad_data",
                                            "error": "invalid parameter \"time\": Invalid time value for 'time': cannot parse \"165232355g\" to a valid timestamp"
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Bad Request"
                    },
                    "500": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/promqlErrorCode"
                                },
                                "examples": {
                                    "内部错误": {
                                        "value": {
                                            "status": "error",
                                            "errorType": "opensearch_internal_error_exception",
                                            "error": "internal error: error connection"
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Internal Service Error"
                    },
                    "503": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/promqlErrorCode"
                                },
                                "examples": {
                                    "timeout": {
                                        "value": {
                                            "status": "error",
                                            "errorType": "timeout",
                                            "error": "query timed out in expression evaluation"
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Service Unavailable"
                    }
                },
                "summary": "promql query",
                "description": "瞬时值查询"
            }
        },
        "/api/uniquery/v1/promql/query_range": {
            "summary": "promql query_range",
            "description": "promql 指标范围查询",
            "post": {
                "requestBody": {
                    "content": {
                        "application/x-www-form-urlencoded": {
                            "schema": {
                                "description": "promql 查询语句",
                                "type": "object",
                                "properties": {
                                    "query": {
                                        "description": "promql 查询语句. 必须. elasticsearch_os_cpu_percent{cluster=\"opensearch\", name=~\"node-1\",ar_indexbase=\"metricbeat,elasticsearch\"}",
                                        "type": "string"
                                    },
                                    "start": {
                                        "format": "int64",
                                        "description": "开始时间. 必须. start=<rfc3339 | unix_timestamp>. 例如: 1646360670",
                                        "type": "integer"
                                    },
                                    "end": {
                                        "format": "int64",
                                        "description": "结束时间. 必须. end=<rfc3339 | unix_timestamp>. 例如: 1646471470",
                                        "type": "integer"
                                    },
                                    "step": {
                                        "description": "查询解析度, 即步长. 默认单位是秒, 必须. step=<1h|30m|5s|10ms|... >. 例如: 30s",
                                        "type": "string"
                                    },
                                    "timeout": {
                                        "description": "超时时间设置. 默认单位是秒, 非必须. timeout=<1h|30m|5s|10ms|...>. 例如: 1s",
                                        "type": "string"
                                    }
                                }
                            },
                            "examples": {
                                "时间序列选择器": {
                                    "value": "query=prometheus.metrics.opensearch_indices_shards_docs{prometheus.labels.clust=\"opensearch\",prometheus.labels.index=~\"a.*|node.*\",ar_indexbase=\"metricbeat,es\"}&start=1652320556&end=1652323553&step=3"
                                },
                                "start 参数错误": {
                                    "value": "query=prometheus.metrics.opensearch_indices_shards_docs{prometheus.labels.cluster=\"opensearch\",prometheus.labels.index=~\"a.*|node.*\",ar_indexbase=\"metricbeat,es\"}&start=1652320556s&end=1652323553&step=3"
                                },
                                "四则运算 - 两个标量之和": {
                                    "value": "query=1+2&start=1653533598&end=1653534198&step=300"
                                },
                                "四则运算 - 向量除以标量": {
                                    "value": "query=go_memstats_alloc_bytes{ar_indexbase=\"metricbeat,es\"} / 1024&start=1653915694&end=1653916694&step=300"
                                },
                                "四则运算 - 两个向量之和": {
                                    "value": "query=go_memstats_heap_alloc_bytes{ar_indexbase=\"metricbeat,es\"} + go_memstats_heap_idle_bytes{ar_indexbase=\"metricbeat,es\"}&start=1653915694&end=1653916694&step=300"
                                },
                                "两个向量基于on的四则运算": {
                                    "value": "query=net_conntrack_dialer_conn_closed_total{ar_indexbase=\"metricbeat,es\"} + on(dialer_name) net_conntrack_dialer_conn_closed_total{ar_indexbase=\"metricbeat,es\"}&start=1653915694&end=1653916694&step=300"
                                },
                                "time()算子": {
                                    "value": "query=time()&start=1653533598&end=1653533600&step=1"
                                }
                            }
                        }
                    },
                    "required": true
                },
                "responses": {
                    "200": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object"
                                },
                                "examples": {
                                    "时间序列选择器": {
                                        "value": {
                                            "status": "success",
                                            "data": {
                                                "resultType": "matrix",
                                                "result": [
                                                    {
                                                        "metric": [
                                                            {
                                                                "cluster": "opensearch",
                                                                "es_client_node": "true",
                                                                "es_data_node": "true",
                                                                "es_ingest_node": "true",
                                                                "es_master_node": "true",
                                                                "host": "10.4.106.127",
                                                                "instance": "10.4.106.127:9114",
                                                                "job": "elasticsearch",
                                                                "name": "node-1"
                                                            }
                                                        ],
                                                        "values": [
                                                            [
                                                                1646211390,
                                                                "10"
                                                            ],
                                                            [
                                                                1646211420,
                                                                "9"
                                                            ],
                                                            [
                                                                1646211450,
                                                                "14"
                                                            ],
                                                            [
                                                                1646211480,
                                                                "32"
                                                            ],
                                                            [
                                                                1646211510,
                                                                "15"
                                                            ],
                                                            [
                                                                1646211540,
                                                                "8"
                                                            ],
                                                            [
                                                                1646211570,
                                                                "6"
                                                            ],
                                                            [
                                                                1646211600,
                                                                "7"
                                                            ],
                                                            [
                                                                1646211630,
                                                                "17"
                                                            ],
                                                            [
                                                                1646211660,
                                                                "18"
                                                            ],
                                                            [
                                                                1646211690,
                                                                "31"
                                                            ],
                                                            [
                                                                1646211720,
                                                                "22"
                                                            ],
                                                            [
                                                                1646211750,
                                                                "9"
                                                            ],
                                                            [
                                                                1646211780,
                                                                "6"
                                                            ],
                                                            [
                                                                1646211810,
                                                                "6"
                                                            ],
                                                            [
                                                                1646211840,
                                                                "19"
                                                            ],
                                                            [
                                                                1646211870,
                                                                "18"
                                                            ],
                                                            [
                                                                1646211900,
                                                                "25"
                                                            ],
                                                            [
                                                                1646211930,
                                                                "5"
                                                            ],
                                                            [
                                                                1646211960,
                                                                "17"
                                                            ],
                                                            [
                                                                1646211990,
                                                                "6"
                                                            ],
                                                            [
                                                                1646212020,
                                                                "17"
                                                            ],
                                                            [
                                                                1646212050,
                                                                "33"
                                                            ],
                                                            [
                                                                1646212080,
                                                                "9"
                                                            ],
                                                            [
                                                                1646212110,
                                                                "6"
                                                            ],
                                                            [
                                                                1646212140,
                                                                "10"
                                                            ],
                                                            [
                                                                1646212170,
                                                                "5"
                                                            ],
                                                            [
                                                                1646212200,
                                                                "5"
                                                            ],
                                                            [
                                                                1646212230,
                                                                "18"
                                                            ],
                                                            [
                                                                1646212260,
                                                                "28"
                                                            ],
                                                            [
                                                                1646212290,
                                                                "18"
                                                            ],
                                                            [
                                                                1646212320,
                                                                "11"
                                                            ],
                                                            [
                                                                1646212350,
                                                                "15"
                                                            ],
                                                            [
                                                                1646212380,
                                                                "6"
                                                            ],
                                                            [
                                                                1646212410,
                                                                "5"
                                                            ],
                                                            [
                                                                1646212440,
                                                                "11"
                                                            ],
                                                            [
                                                                1646212470,
                                                                "25"
                                                            ],
                                                            [
                                                                1646212500,
                                                                "12"
                                                            ],
                                                            [
                                                                1646212530,
                                                                "14"
                                                            ],
                                                            [
                                                                1646212560,
                                                                "9"
                                                            ],
                                                            [
                                                                1646212590,
                                                                "6"
                                                            ],
                                                            [
                                                                1646212620,
                                                                "5"
                                                            ],
                                                            [
                                                                1646212650,
                                                                "14"
                                                            ],
                                                            [
                                                                1646212680,
                                                                "28"
                                                            ],
                                                            [
                                                                1646212710,
                                                                "28"
                                                            ],
                                                            [
                                                                1646212740,
                                                                "6"
                                                            ],
                                                            [
                                                                1646212770,
                                                                "15"
                                                            ],
                                                            [
                                                                1646212800,
                                                                "6"
                                                            ],
                                                            [
                                                                1646212830,
                                                                "6"
                                                            ],
                                                            [
                                                                1646212860,
                                                                "12"
                                                            ],
                                                            [
                                                                1646212890,
                                                                "36"
                                                            ],
                                                            [
                                                                1646212920,
                                                                "39"
                                                            ],
                                                            [
                                                                1646212950,
                                                                "21"
                                                            ],
                                                            [
                                                                1646212980,
                                                                "39"
                                                            ],
                                                            [
                                                                1646213010,
                                                                "7"
                                                            ],
                                                            [
                                                                1646213040,
                                                                "11"
                                                            ],
                                                            [
                                                                1646213070,
                                                                "31"
                                                            ],
                                                            [
                                                                1646213100,
                                                                "32"
                                                            ],
                                                            [
                                                                1646213130,
                                                                "27"
                                                            ],
                                                            [
                                                                1646213160,
                                                                "36"
                                                            ]
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    "四则运算 - 两个标量之和": {
                                        "value": {
                                            "status": "success",
                                            "data": {
                                                "resultType": "matrix",
                                                "result": [
                                                    {
                                                        "metric": {

                                                        },
                                                        "values": [
                                                            [
                                                                1653533598,
                                                                "3"
                                                            ],
                                                            [
                                                                1653533898,
                                                                "3"
                                                            ],
                                                            [
                                                                1653534198,
                                                                "3"
                                                            ]
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    "四则运算 - 向量除以标量": {
                                        "value": {
                                            "status": "success",
                                            "data": {
                                                "resultType": "vector",
                                                "result": [
                                                    {
                                                        "metric": {
                                                            "instance": "localhost:9090",
                                                            "job": "prometheus"
                                                        },
                                                        "value": [
                                                            1.653915801951E9,
                                                            "53392.6640625"
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    "四则运算 - 两个向量之和": {
                                        "value": {
                                            "status": "success",
                                            "data": {
                                                "resultType": "vector",
                                                "result": [
                                                    {
                                                        "metric": {
                                                            "instance": "localhost:9090",
                                                            "job": "prometheus"
                                                        },
                                                        "value": [
                                                            1.653915978927E9,
                                                            "59380024"
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    "基于on的四则运算": {
                                        "value": {
                                            "status": "success",
                                            "data": {
                                                "resultType": "matrix",
                                                "result": [
                                                    {
                                                        "metric": {
                                                            "dialer_name": "alertmanager"
                                                        },
                                                        "values": [
                                                            [
                                                                1655125563,
                                                                "0"
                                                            ],
                                                            [
                                                                1655125863,
                                                                "0"
                                                            ],
                                                            [
                                                                1655126163,
                                                                "0"
                                                            ]
                                                        ]
                                                    },
                                                    {
                                                        "metric": {
                                                            "dialer_name": "default"
                                                        },
                                                        "values": [
                                                            [
                                                                1655125563,
                                                                "0"
                                                            ],
                                                            [
                                                                1655125863,
                                                                "0"
                                                            ],
                                                            [
                                                                1655126163,
                                                                "0"
                                                            ]
                                                        ]
                                                    },
                                                    {
                                                        "metric": {
                                                            "dialer_name": "prometheus"
                                                        },
                                                        "values": [
                                                            [
                                                                1655125563,
                                                                "1"
                                                            ],
                                                            [
                                                                1655125863,
                                                                "1"
                                                            ],
                                                            [
                                                                1655126163,
                                                                "1"
                                                            ]
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    "算子time()": {
                                        "value": {
                                            "status": "success",
                                            "data": {
                                                "resultType": "matrix",
                                                "result": [
                                                    {
                                                        "metric": {

                                                        },
                                                        "values": [
                                                            [
                                                                1653533598,
                                                                "1653533598"
                                                            ],
                                                            [
                                                                1653533899,
                                                                "1653533599"
                                                            ],
                                                            [
                                                                1653533600,
                                                                "1653533600"
                                                            ]
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/promqlErrorCode"
                                },
                                "examples": {
                                    "start 参数错误": {
                                        "value": {
                                            "status": "error",
                                            "errorType": "bad_data",
                                            "error": "invalid parameter 'end': cannot parse \"1646471470s\" to a valid timestamp"
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Bad Request"
                    },
                    "500": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/promqlErrorCode"
                                },
                                "examples": {
                                    "内部错误": {
                                        "value": {
                                            "status": "error",
                                            "errorType": "opensearch_internal_error_exception",
                                            "error": "internal error: error connection"
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Internal Service Error"
                    },
                    "503": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/promqlErrorCode"
                                },
                                "examples": {
                                    "timeout": {
                                        "value": {
                                            "status": "error",
                                            "errorType": "timeout",
                                            "error": "query timed out in expression evaluation"
                                        }
                                    }
                                }
                            }
                        },
                        "description": "Service Unavailable"
                    }
                },
                "summary": "promql query_range",
                "description": "指标范围查询"
            }
        }
    },
    "components": {
        "schemas": {
            "errorCode": {
                "description": "错误信息返回格式",
                "required": [
                    "error",
                    "status"
                ],
                "type": "object",
                "properties": {
                    "error": {
                        "description": "错误体",
                        "required": [
                            "type",
                            "reason"
                        ],
                        "type": "object",
                        "properties": {
                            "root_cause": {
                                "description": "根错误信息",
                                "type": "array",
                                "items": {
                                    "type": "object"
                                }
                            },
                            "type": {
                                "description": "错误类型",
                                "minLength": 1,
                                "type": "string"
                            },
                            "reason": {
                                "description": "原因",
                                "minLength": 1,
                                "type": "string"
                            },
                            "failed_shards": {
                                "description": "失败的分片及其原因",
                                "type": "array",
                                "items": {
                                    "type": "object"
                                }
                            },
                            "caused_by": {
                                "description": "详细的错误信息",
                                "type": "object"
                            }
                        }
                    },
                    "status": {
                        "description": "状态码",
                        "type": "number"
                    }
                },
                "x-examples": {
                    "example-1": {
                        "error": {
                            "root_cause": [
                            ],
                            "type": "x_content_parse_exception",
                            "reason": "[1:438] [bool] failed to parse field [must]",
                            "failed_shareds": [
                            ],
                            "caused_by": {

                            }
                        },
                        "status": 400
                    }
                }
            },
            "promqlErrorCode": {
                "title": "Root Type for promqlErrorCode",
                "description": "promql 错误信息返回格式",
                "required": [
                    "error",
                    "errorType",
                    "status"
                ],
                "type": "object",
                "properties": {
                    "status": {
                        "description": "状态",
                        "type": "string",
                        "example": "error"
                    },
                    "errorType": {
                        "description": "错误类型",
                        "type": "string",
                        "example": "timeout"
                    },
                    "error": {
                        "description": "错误体",
                        "type": "string",
                        "example": "query timed out in expression evaluation"
                    }
                },
                "example": {
                    "status": "error",
                    "errorType": "timeout",
                    "error": "query timed out in expression evaluation"
                }
            }
        }
    }
}